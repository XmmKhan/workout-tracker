<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Трекер тренировок</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overscroll-behavior: none;
            overflow-x: hidden;
        }
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        #root { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
      const { useState, useEffect } = React;

      const WorkoutTracker = () => {
        const [currentDate, setCurrentDate] = useState(new Date());
        const [workouts, setWorkouts] = useState({});
        const [selectedDate, setSelectedDate] = useState(null);
        const [selectedWorkout, setSelectedWorkout] = useState(null);
        const [showWorkoutModal, setShowWorkoutModal] = useState(false);
        const [showExerciseModal, setShowExerciseModal] = useState(false);
        const [showStatsView, setShowStatsView] = useState(false);
        const [selectedExerciseStats, setSelectedExerciseStats] = useState(null);
        const [editingExercise, setEditingExercise] = useState(null);
        const [workoutName, setWorkoutName] = useState('');
        const [exerciseName, setExerciseName] = useState('');
        const [sets, setSets] = useState([{ reps: '', weight: '' }]);
        
        // Хуки для графика - ВСЕГДА вызываем, не условно!
        const chartRef = React.useRef(null);
        const chartInstance = React.useRef(null);

        useEffect(() => {
          const saved = localStorage.getItem('workouts');
          if (saved) setWorkouts(JSON.parse(saved));
        }, []);

        useEffect(() => {
          localStorage.setItem('workouts', JSON.stringify(workouts));
        }, [workouts]);

        useEffect(() => {
          if (showWorkoutModal || showExerciseModal) {
            document.body.classList.add('modal-open');
          } else {
            document.body.classList.remove('modal-open');
          }
          return () => document.body.classList.remove('modal-open');
        }, [showWorkoutModal, showExerciseModal]);

        useEffect(() => {
          window.scrollTo(0, 0);
        }, [selectedDate, selectedWorkout]);

        const getWeekDays = (date) => {
          const day = date.getDay();
          const diff = date.getDate() - day + (day === 0 ? -6 : 1);
          const monday = new Date(date.setDate(diff));
          const week = [];
          for (let i = 0; i < 7; i++) {
            const weekDay = new Date(monday);
            weekDay.setDate(monday.getDate() + i);
            week.push(weekDay);
          }
          return week;
        };

        const formatDate = (date) => {
          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        };

        const getAllExercises = () => {
          const exerciseMap = new Map();
          Object.entries(workouts).forEach(([dateKey, dayWorkouts]) => {
            dayWorkouts.forEach(workout => {
              workout.exercises.forEach(exercise => {
                if (!exerciseMap.has(exercise.name)) {
                  exerciseMap.set(exercise.name, []);
                }
                exerciseMap.get(exercise.name).push({
                  date: dateKey,
                  sets: exercise.sets || [],
                  workoutName: workout.name
                });
              });
            });
          });
          return Array.from(exerciseMap.entries()).map(([name, history]) => ({
            name,
            history: history.sort((a, b) => new Date(a.date) - new Date(b.date)),
            totalSessions: history.length
          }));
        };

        const getExerciseStats = (exerciseName) => {
          const exercises = getAllExercises().find(e => e.name === exerciseName);
          if (!exercises) return null;
          const stats = exercises.history.map(session => {
            const maxWeight = Math.max(...session.sets.map(s => parseFloat(s.weight) || 0));
            const totalVolume = session.sets.reduce((sum, s) => {
              return sum + (parseFloat(s.reps) || 0) * (parseFloat(s.weight) || 0);
            }, 0);
            return {
              date: session.date,
              maxWeight,
              totalVolume,
              setsCount: session.sets.length,
              workoutName: session.workoutName
            };
          });
          return {
            name: exerciseName,
            sessions: stats,
            maxWeightEver: Math.max(...stats.map(s => s.maxWeight)),
            maxVolumeEver: Math.max(...stats.map(s => s.totalVolume)),
            totalSessions: stats.length
          };
        };

        const createWorkout = () => {
          if (!workoutName.trim() || !selectedDate) return;
          const dateKey = formatDate(selectedDate);
          const newWorkout = { id: Date.now(), name: workoutName, exercises: [] };
          setWorkouts(prev => ({ ...prev, [dateKey]: [...(prev[dateKey] || []), newWorkout] }));
          setWorkoutName('');
          setShowWorkoutModal(false);
        };

        const deleteWorkout = (dateKey, workoutId) => {
          setWorkouts(prev => ({ ...prev, [dateKey]: prev[dateKey].filter(w => w.id !== workoutId) }));
          setSelectedWorkout(null);
        };

        const addExercise = () => {
          if (!exerciseName.trim() || !selectedWorkout) return;
          const dateKey = formatDate(selectedDate);
          const filteredSets = sets.filter(set => set.reps || set.weight);
          if (filteredSets.length === 0) return;
          
          if (editingExercise) {
            setWorkouts(prev => ({
              ...prev,
              [dateKey]: prev[dateKey].map(w => 
                w.id === selectedWorkout.id 
                  ? { ...w, exercises: w.exercises.map(e => 
                      e.id === editingExercise.id 
                        ? { ...e, name: exerciseName, sets: filteredSets }
                        : e
                    )}
                  : w
              )
            }));
            setEditingExercise(null);
          } else {
            const newExercise = { id: Date.now(), name: exerciseName, sets: filteredSets };
            setWorkouts(prev => ({
              ...prev,
              [dateKey]: prev[dateKey].map(w => 
                w.id === selectedWorkout.id ? { ...w, exercises: [...w.exercises, newExercise] } : w
              )
            }));
          }
          
          setExerciseName('');
          setSets([{ reps: '', weight: '' }]);
          setShowExerciseModal(false);
        };

        const deleteExercise = (exerciseId) => {
          const dateKey = formatDate(selectedDate);
          setWorkouts(prev => ({
            ...prev,
            [dateKey]: prev[dateKey].map(w => 
              w.id === selectedWorkout.id ? { ...w, exercises: w.exercises.filter(e => e.id !== exerciseId) } : w
            )
          }));
        };

        const startEditExercise = (exercise) => {
          setEditingExercise(exercise);
          setExerciseName(exercise.name);
          setSets(exercise.sets && exercise.sets.length > 0 ? exercise.sets : [{ reps: '', weight: '' }]);
          setShowExerciseModal(true);
        };

        const addSet = () => setSets([...sets, { reps: '', weight: '' }]);
        const removeSet = (index) => { if (sets.length > 1) setSets(sets.filter((_, i) => i !== index)); };
        const updateSet = (index, field, value) => {
          const newSets = [...sets];
          newSets[index][field] = value;
          setSets(newSets);
        };

        const changeWeek = (direction) => {
          const newDate = new Date(currentDate);
          newDate.setDate(currentDate.getDate() + (direction * 7));
          setCurrentDate(newDate);
        };

        const weekDays = getWeekDays(new Date(currentDate));
        const monthNames = ['Января', 'Февраля', 'Марта', 'Апреля', 'Мая', 'Июня', 'Июля', 'Августа', 'Сентября', 'Октября', 'Ноября', 'Декабря'];
        const dayNames = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
        
        // Подготовка данных для графика - делаем ВСЕГДА, не условно
        const stats = selectedExerciseStats ? getExerciseStats(selectedExerciseStats) : null;
        const chartData = stats ? stats.sessions.map((session) => {
          const date = new Date(session.date);
          return {
            date: date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' }),
            weight: session.maxWeight,
            volume: session.totalVolume
          };
        }) : [];
        
        const hasChart = typeof Chart !== 'undefined';
        
        // useEffect для графика - ВСЕГДА вызываем
        React.useEffect(() => {
          if (!selectedExerciseStats || !hasChart || !chartRef.current || chartData.length < 2) {
            return;
          }
          
          console.log('Chart.js доступен:', hasChart);
          console.log('Данных для графика:', chartData.length);
          console.log('Данные:', chartData);
          
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }
          
          try {
            const ctx = chartRef.current.getContext('2d');
            console.log('Создаю график...');
            chartInstance.current = new Chart(ctx, {
              type: 'line',
              data: {
                labels: chartData.map(d => d.date),
                datasets: [{
                  label: 'Макс. вес (кг)',
                  data: chartData.map(d => d.weight),
                  borderColor: '#9333ea',
                  backgroundColor: 'rgba(147, 51, 234, 0.1)',
                  borderWidth: 3,
                  tension: 0.3,
                  pointRadius: 5,
                  pointBackgroundColor: '#9333ea',
                  pointBorderColor: '#fff',
                  pointBorderWidth: 2,
                  pointHoverRadius: 7
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: true,
                    position: 'top',
                    labels: {
                      font: { size: 12, weight: 'bold' },
                      color: '#9333ea'
                    }
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      font: { size: 11 },
                      color: '#666'
                    }
                  },
                  x: {
                    ticks: {
                      font: { size: 11 },
                      color: '#666'
                    }
                  }
                }
              }
            });
            console.log('График создан успешно!');
          } catch (error) {
            console.error('Ошибка создания графика:', error);
          }
          
          return () => {
            if (chartInstance.current) {
              chartInstance.current.destroy();
            }
          };
        }, [selectedExerciseStats, chartData.length, hasChart]);

        if (selectedExerciseStats && stats) {
          
          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-4">
              <div className="max-w-md mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
                <div className="bg-gradient-to-r from-purple-500 to-blue-500 p-6 text-white">
                  <button onClick={() => setSelectedExerciseStats(null)} className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    <span>Назад</span>
                  </button>
                  <h2 className="text-2xl font-bold">{stats.name}</h2>
                  <p className="text-purple-100 mt-1">{stats.totalSessions} тренировок</p>
                </div>
                <div className="p-6">
                  <div className="grid grid-cols-2 gap-3 mb-6">
                    <div className="bg-gradient-to-br from-purple-100 to-purple-50 rounded-2xl p-4 text-center">
                      <p className="text-sm text-purple-600 mb-1">Макс. вес</p>
                      <p className="text-2xl font-bold text-purple-700">{stats.maxWeightEver} кг</p>
                    </div>
                    <div className="bg-gradient-to-br from-blue-100 to-blue-50 rounded-2xl p-4 text-center">
                      <p className="text-sm text-blue-600 mb-1">Макс. объём</p>
                      <p className="text-2xl font-bold text-blue-700">{stats.maxVolumeEver.toFixed(0)} кг</p>
                    </div>
                  </div>
                  
                  {/* ГРАФИК - ОБЯЗАТЕЛЬНО ВИДИМЫЙ */}
                  <div className="mb-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">График прогресса</h3>
                    
                    {chartData.length >= 2 && hasChart ? (
                      <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-4">
                        <div style={{position: 'relative', height: '250px', width: '100%'}}>
                          <canvas ref={chartRef}></canvas>
                        </div>
                      </div>
                    ) : (
                      <div className="bg-yellow-100 border-2 border-yellow-500 rounded-2xl p-4">
                        <p className="text-yellow-800 font-semibold mb-2">⚠️ График не показывается</p>
                        <div className="text-xs text-yellow-700 space-y-1">
                          <p>• Тренировок: {chartData.length} {chartData.length >= 2 ? '✅' : '❌ нужно 2+'}</p>
                          <p>• Chart.js: {hasChart ? '✅ загружен' : '❌ НЕ загружен'}</p>
                          <p>• Данные: {JSON.stringify(chartData)}</p>
                        </div>
                      </div>
                    )}
                  </div>
                  
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">История тренировок</h3>
                  <div className="space-y-3">
                    {stats.sessions.map((session, index) => {
                      const date = new Date(session.date);
                      const isImprovement = index > 0 && session.maxWeight > stats.sessions[index - 1].maxWeight;
                      return (
                        <div key={index} className="bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl p-4">
                          <div className="flex justify-between items-start mb-3">
                            <div>
                              <p className="font-semibold text-gray-800">{date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })}</p>
                              <p className="text-xs text-gray-500 mt-1">{session.workoutName}</p>
                            </div>
                            {isImprovement && (
                              <span className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full flex items-center gap-1">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                  <polyline points="17 6 23 6 23 12"/>
                                </svg>
                                Прогресс
                              </span>
                            )}
                          </div>
                          <div className="grid grid-cols-3 gap-2">
                            <div className="bg-white rounded-xl p-2 text-center">
                              <p className="text-xs text-gray-500">Макс. вес</p>
                              <p className="font-bold text-purple-600">{session.maxWeight} кг</p>
                            </div>
                            <div className="bg-white rounded-xl p-2 text-center">
                              <p className="text-xs text-gray-500">Объём</p>
                              <p className="font-bold text-blue-600">{session.totalVolume.toFixed(0)}</p>
                            </div>
                            <div className="bg-white rounded-xl p-2 text-center">
                              <p className="text-xs text-gray-500">Подходов</p>
                              <p className="font-bold text-pink-600">{session.setsCount}</p>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>
          );
        }

        if (showStatsView) {
          const allExercises = getAllExercises();
          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-4">
              <div className="max-w-md mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
                <div className="bg-gradient-to-r from-purple-500 to-blue-500 p-6 text-white">
                  <button onClick={() => setShowStatsView(false)} className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    <span>Назад</span>
                  </button>
                  <h2 className="text-2xl font-bold">Статистика</h2>
                  <p className="text-purple-100 mt-1">Прогресс по упражнениям</p>
                </div>
                <div className="p-6">
                  {allExercises.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <svg width="48" height="48" className="mx-auto mb-4 opacity-50" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M3 3v18h18"/>
                        <path d="M18 17V9"/>
                        <path d="M13 17V5"/>
                        <path d="M8 17v-3"/>
                      </svg>
                      <p>Нет данных</p>
                      <p className="text-sm mt-2">Добавьте тренировки для отслеживания прогресса</p>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {allExercises.map(exercise => (
                        <button key={exercise.name} onClick={() => setSelectedExerciseStats(exercise.name)}
                          className="w-full bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-4 hover:shadow-md transition text-left">
                          <div className="flex justify-between items-center">
                            <div>
                              <h4 className="font-semibold text-gray-800">{exercise.name}</h4>
                              <p className="text-sm text-gray-500 mt-1">{exercise.totalSessions} {exercise.totalSessions === 1 ? 'тренировка' : 'тренировок'}</p>
                            </div>
                            <svg className="text-gray-400" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                              <polyline points="9 18 15 12 9 6"/>
                            </svg>
                          </div>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        }

        if (selectedWorkout) {
          const dateKey = formatDate(selectedDate);
          const currentWorkout = workouts[dateKey]?.find(w => w.id === selectedWorkout.id);
          
          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-4">
              <div className="max-w-md mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
                <div className="bg-gradient-to-r from-purple-500 to-blue-500 p-6 text-white">
                  <button onClick={() => setSelectedWorkout(null)} className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    <span>Назад</span>
                  </button>
                  <h2 className="text-2xl font-bold">{currentWorkout?.name}</h2>
                  <p className="text-purple-100 mt-1">{selectedDate.toLocaleDateString('ru-RU')}</p>
                </div>
                <div className="p-6">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold text-gray-800">Упражнения</h3>
                    <button onClick={() => setShowExerciseModal(true)} className="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-2 rounded-full hover:shadow-lg transition">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                      </svg>
                    </button>
                  </div>
                  {currentWorkout?.exercises.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <p>Нет упражнений</p>
                      <p className="text-sm mt-2">Нажмите + чтобы добавить</p>
                    </div>
                  ) : (
                    <div className="space-y-4">
                      {currentWorkout?.exercises.map(exercise => (
                        <div key={exercise.id} className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-4">
                          <div className="flex justify-between items-start mb-3">
                            <h4 className="font-semibold text-gray-800 text-lg">{exercise.name}</h4>
                            <div className="flex gap-2">
                              <button onClick={() => startEditExercise(exercise)} className="text-blue-500 hover:text-blue-700">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                              </button>
                              <button onClick={() => deleteExercise(exercise.id)} className="text-red-400 hover:text-red-600">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                  <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                              </button>
                            </div>
                          </div>
                          <div className="space-y-2">
                            {(exercise.sets && Array.isArray(exercise.sets) ? exercise.sets : []).map((set, index) => (
                              <div key={index} className="bg-white rounded-xl p-3 flex items-center gap-3">
                                <span className="text-sm font-semibold text-gray-500 w-8">#{index + 1}</span>
                                <div className="flex-1 flex gap-3">
                                  <div className="flex-1 text-center">
                                    <p className="text-xs text-gray-500 mb-1">Повторы</p>
                                    <p className="font-bold text-blue-600">{set.reps}</p>
                                  </div>
                                  <div className="flex-1 text-center">
                                    <p className="text-xs text-gray-500 mb-1">Вес (кг)</p>
                                    <p className="font-bold text-pink-600">{set.weight || '—'}</p>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                {showExerciseModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end z-50">
                    <div className="bg-white w-full rounded-t-3xl p-6 max-h-[90vh] overflow-y-auto" style={{animation: 'slideUp 0.3s ease-out'}}>
                      <h3 className="text-xl font-bold mb-4 text-gray-800">{editingExercise ? 'Редактировать упражнение' : 'Новое упражнение'}</h3>
                      <input type="text" placeholder="Название упражнения" value={exerciseName} onChange={(e) => setExerciseName(e.target.value)}
                        className="w-full p-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-500 outline-none" />
                      <div className="mb-4">
                        <div className="flex justify-between items-center mb-3">
                          <h4 className="font-semibold text-gray-700">Подходы</h4>
                          <button onClick={addSet} className="text-purple-600 hover:text-purple-700 font-semibold text-sm flex items-center gap-1">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                              <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Добавить подход
                          </button>
                        </div>
                        <div className="space-y-2">
                          {sets.map((set, index) => (
                            <div key={index} className="flex items-center gap-1">
                              <span className="text-xs font-semibold text-gray-500 w-5 flex-shrink-0">#{index + 1}</span>
                              <input type="number" placeholder="Повт" value={set.reps} onChange={(e) => updateSet(index, 'reps', e.target.value)}
                                className="w-20 p-2 text-sm border-2 border-gray-200 rounded-xl focus:border-purple-500 outline-none" />
                              <input type="number" placeholder="Вес" value={set.weight} onChange={(e) => updateSet(index, 'weight', e.target.value)}
                                className="w-20 p-2 text-sm border-2 border-gray-200 rounded-xl focus:border-purple-500 outline-none" />
                              {sets.length > 1 && (
                                <button onClick={() => removeSet(index)} className="text-red-400 hover:text-red-600 flex-shrink-0 ml-1">
                                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                  </svg>
                                </button>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                      <div className="flex gap-3">
                        <button onClick={() => { setShowExerciseModal(false); setExerciseName(''); setSets([{ reps: '', weight: '' }]); setEditingExercise(null); }}
                          className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300">Отмена</button>
                        <button onClick={addExercise} className="flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-xl font-semibold hover:shadow-lg">
                          {editingExercise ? 'Сохранить' : 'Добавить'}
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        if (selectedDate && !selectedWorkout) {
          const dateKey = formatDate(selectedDate);
          const dateWorkouts = workouts[dateKey] || [];
          
          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-4">
              <div className="max-w-md mx-auto bg-white rounded-3xl shadow-xl overflow-hidden">
                <div className="bg-gradient-to-r from-purple-500 to-blue-500 p-6 text-white">
                  <button onClick={() => setSelectedDate(null)} className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    <span>Назад</span>
                  </button>
                  <h2 className="text-2xl font-bold">{selectedDate.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</h2>
                </div>
                <div className="p-6">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold text-gray-800">Тренировки</h3>
                    <button onClick={() => setShowWorkoutModal(true)} className="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-2 rounded-full hover:shadow-lg transition">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                      </svg>
                    </button>
                  </div>
                  {dateWorkouts.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <svg width="48" height="48" className="mx-auto mb-4 opacity-50" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                      </svg>
                      <p>Нет тренировок</p>
                      <p className="text-sm mt-2">Нажмите + чтобы добавить</p>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {dateWorkouts.map(workout => (
                        <div key={workout.id} onClick={() => setSelectedWorkout(workout)}
                          className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-4 hover:shadow-md transition cursor-pointer">
                          <div className="flex justify-between items-center">
                            <div>
                              <h4 className="font-semibold text-gray-800">{workout.name}</h4>
                              <p className="text-sm text-gray-500 mt-1">{workout.exercises.length} {workout.exercises.length === 1 ? 'упражнение' : 'упражнений'}</p>
                            </div>
                            <button onClick={(e) => { e.stopPropagation(); deleteWorkout(dateKey, workout.id); }} className="text-red-400 hover:text-red-600">
                              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                              </svg>
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                {showWorkoutModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end z-50">
                    <div className="bg-white w-full rounded-t-3xl p-6" style={{animation: 'slideUp 0.3s ease-out'}}>
                      <h3 className="text-xl font-bold mb-4 text-gray-800">Новая тренировка</h3>
                      <input type="text" placeholder="Название тренировки" value={workoutName} onChange={(e) => setWorkoutName(e.target.value)}
                        className="w-full p-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-purple-500 outline-none" />
                      <div className="flex gap-3">
                        <button onClick={() => setShowWorkoutModal(false)} className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300">Отмена</button>
                        <button onClick={createWorkout} className="flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-xl font-semibold hover:shadow-lg">Создать</button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const hasAnyWorkouts = Object.keys(workouts).length > 0;

        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-4 pb-24">
            <div className="max-w-md mx-auto">
              <div className="bg-white rounded-3xl shadow-xl overflow-hidden mb-4">
                <div className="bg-gradient-to-r from-purple-500 to-blue-500 p-6 text-white">
                  <div className="flex justify-between items-center mb-4">
                    <button onClick={() => changeWeek(-1)} className="p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <polyline points="15 18 9 12 15 6"/>
                      </svg>
                    </button>
                    <div className="text-center">
                      <h2 className="text-xl font-bold">
                        {weekDays[0].getMonth() === weekDays[6].getMonth() 
                          ? `${weekDays[0].getDate()} - ${weekDays[6].getDate()} ${monthNames[weekDays[3].getMonth()]}`
                          : `${weekDays[0].getDate()} ${monthNames[weekDays[0].getMonth()].slice(0, -1)} - ${weekDays[6].getDate()} ${monthNames[weekDays[6].getMonth()]}`
                        }
                      </h2>
                      <p className="text-sm text-purple-100 mt-1">{weekDays[0].getFullYear()}</p>
                    </div>
                    <button onClick={() => changeWeek(1)} className="p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <polyline points="9 18 15 12 9 6"/>
                      </svg>
                    </button>
                  </div>
                  <button onClick={() => setShowStatsView(true)}
                    className="w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-xl p-3 flex items-center justify-center gap-2 transition">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M3 3v18h18"/>
                      <path d="M18 17V9"/>
                      <path d="M13 17V5"/>
                      <path d="M8 17v-3"/>
                    </svg>
                    <span className="font-semibold">Статистика</span>
                  </button>
                </div>
                <div className="p-4">
                  {!hasAnyWorkouts && (
                    <div className="bg-purple-50 border-2 border-purple-200 rounded-2xl p-4 mb-4 text-center">
                      <p className="text-purple-800 font-semibold mb-2">👇 Нажмите на день</p>
                      <p className="text-purple-600 text-sm">Выберите дату, чтобы добавить тренировку</p>
                    </div>
                  )}
                  <div className="grid grid-cols-7 gap-2 mb-2">
                    {dayNames.map(day => (
                      <div key={day} className="text-center text-xs font-semibold text-gray-500 py-1">{day}</div>
                    ))}
                  </div>
                  <div className="grid grid-cols-7 gap-2">
                    {weekDays.map((date, index) => {
                      const dateKey = formatDate(date);
                      const dateWorkouts = workouts[dateKey] || [];
                      const hasWorkout = dateWorkouts.length > 0;
                      const isToday = date.toDateString() === today.toDateString();
                      
                      return (
                        <button key={index} onClick={() => setSelectedDate(date)}
                          className={`rounded-xl p-2 text-center transition min-h-[60px] flex flex-col justify-center items-center relative
                            ${isToday ? 'ring-2 ring-purple-500' : ''}
                            ${hasWorkout ? 'bg-gradient-to-br from-purple-500 to-blue-500 text-white hover:shadow-lg' : 'bg-gray-50 hover:bg-purple-100 text-gray-700 hover:ring-2 hover:ring-purple-300'}`}>
                          <span className="font-bold text-sm">{date.getDate()}</span>
                          {!hasWorkout && !hasAnyWorkouts && (
                            <svg width="16" height="16" className="mt-1 opacity-50" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                              <line x1="12" y1="5" x2="12" y2="19"/>
                              <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                          )}
                        </button>
                      );
                    })}
                  </div>
                </div>
              </div>
              <div className="space-y-3">
                {weekDays.map((date) => {
                  const dateKey = formatDate(date);
                  const dateWorkouts = workouts[dateKey] || [];
                  const isToday = date.toDateString() === today.toDateString();
                  if (dateWorkouts.length === 0) return null;
                  
                  return (
                    <div key={dateKey} className="bg-white rounded-2xl shadow-lg overflow-hidden">
                      <div className={`p-4 ${isToday ? 'bg-gradient-to-r from-purple-500 to-blue-500 text-white' : 'bg-gray-100 text-gray-800'}`}>
                        <div className="font-semibold">{dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1]}, {date.getDate()} {monthNames[date.getMonth()]}</div>
                      </div>
                      <div className="p-4 space-y-2">
                        {dateWorkouts.map(workout => (
                          <button key={workout.id} onClick={() => { setSelectedDate(date); setSelectedWorkout(workout); }}
                            className="w-full bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-4 hover:shadow-md transition text-left">
                            <div className="font-semibold text-gray-800">{workout.name}</div>
                            <div className="text-sm text-gray-500 mt-1">{workout.exercises.length} {workout.exercises.length === 1 ? 'упражнение' : 'упражнений'}</div>
                          </button>
                        ))}
                      </div>
                    </div>
                  );
                })}
              </div>
              
              <button onClick={() => setSelectedDate(today)}
                className="fixed bottom-6 right-6 bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4 rounded-full shadow-2xl hover:shadow-purple-500/50 transition-all hover:scale-110 z-50"
                style={{boxShadow: '0 10px 40px rgba(147, 51, 234, 0.4)'}}>
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </button>
            </div>
            <style>{`@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }`}</style>
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<WorkoutTracker />);
    </script>
</body>
</html>
